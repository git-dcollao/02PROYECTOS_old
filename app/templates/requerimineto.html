{% extends 'bases/base.html' %}

{% block title %}Ingreso de Requerimientos {% endblock %}

{% block content %}
<div class="container">
  <div class="well text-center">
      <h1>Ingreso de Requerimientos</h1>
  </div>

  <div class="container">
    <div class="row">
        <div class="col md-12">
          <h2>
            Lista de requeriminetos solicitados
            <button class="btn btn-primary float-end" data-bs-target="#exampleModal" data-bs-toggle="modal"
                    type="button">
              Nuevo Requerimiento
            </button>
          </h2>

          <table class="table table-striped">
            <thead>
              <tr>
                <th>Id</th>
                <th>Nombre</th>
                <th>Fecha Ingreso</th>
                <th>ver Descripción</th>
                <th>Estado</th>
                <th>Sector</th>
                <th>Tipo Recinto</th>
                <th>Recinto</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              {%for requerimiento in requerimientos%}
              <tr>
                <td>{{requerimiento.id}}</td>
                <td>{{requerimiento.nombre}}</td>
                <td>{{requerimiento.fecha}}</td>
                <td>{{requerimiento.descripcion}}</td>
                <td>{{requerimiento.estado}}</td>
                <td>{{requerimiento.sector.nombre}}</td>
                <td>{{requerimiento.sector.nombre}}</td>
                <td>{{requerimiento.sector.nombre}}</td>
                <td>
                  <a class="btn p-1 btn-primary btn-sm" 
                     data-bs-target="#exampleModal1{{requerimiento.id}}"
                     data-bs-toggle="modal"
                     href="#">Editar</a> 
                  <form action="{{ url_for('controllers.eliminar_requerimiento', id=requerimiento.id) }}"
                      method="POST" style="display:inline;">
                      <button class="btn p-1 btn-danger btn-sm" 
                      type="submit">Eliminar</button>
                  </form>
                </td>
                <div aria-hidden="true" aria-labelledby="exampleModalLabel1" class="modal fade"
                   id="exampleModal1{{requerimiento.id}}" tabindex="-1">
                  <div class="modal-dialog">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h1 class="modal-title fs-5" id="exampleModalLabel1">Editar información del requerimiento {{requerimiento.nombre}}</h1>
                        <button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button>
                      </div>
                      <div class="modal-body">
                        <form action="{{ url_for('controllers.update_requerimiento', id=requerimiento.id) }}" method="POST">   
                          <div class="form-group">
                            <label>Nombre:</label>
                            <input type="hidden" name="id" value="{{requerimiento.id}}">
                            <input class="form-control" name="name" value="{{requerimiento.nombre}}" required="1" type="text">
                            <input class="form-control" name="fch" value="{{requerimiento.fecha}}" required="1" type="text">
                            <input class="form-control" name="descripcion" value="{{requerimiento.descripcion}}" required="1" type="text">
                            <label>Sector:</label>
                            <select class="form-control" name="id_sector" required="1">
                              {% for sector in sectores %}
                              <option value="{{ sector.id }}" {% if requerimiento.id_sector == sector.id %}selected{% endif %}>
                                {{ sector.nombre }}
                              </option>
                              {% endfor %}
                            </select>
                          </div>
                          <button type="submit" class="btn btn-primary">Actualizar</button>
                        </form>
                      </div>
                      <div class="modal-footer">
                        <button class="btn btn-danger" data-bs-dismiss="modal" type="button">
                          Cerrar
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </tr>
              {%endfor%}
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Modal para agregar nuevo estado -->
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="exampleModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h1 class="modal-title fs-5" id="exampleModalLabel">Agregar Requerimiento</h1>
            <button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button>
          </div>
          <div class="modal-body">
            <form action="{{ url_for('controllers.add_requerimiento') }}" method="POST"> 
              <div class="form-group">
                <label>Nombre:</label>
                <input class="form-control" name="name" required="1" type="text">
                <label>Fecha Ingreso:</label>
                <input class="form-control" name="fecha" required="1" type="text">
                <label>Descripción:</label>
                <input class="form-control" name="descripcion" required="1" type="text">
                <label>sector:</label>
                <select class="form-control" name="id_secto" required="1">
                  <option value="">Seleccione un Sector</option>
                  {% for sector in sectores %}
                  <option value="{{ sector.id }}">{{ sector.nombre }}</option>
                  {% endfor %}
                </select>                        
              </div>
              <button type="submit" class="btn btn-primary">Agregar</button>
            </form>
          </div>
          <div class="modal-footer">
            <button class="btn btn-danger" data-bs-dismiss="modal" type="button">Cerrar</button>
          </div>
        </div>
      </div>
    </div>
  </div>
<div class="well container">
  
</div>

<!-- Agregar al final del archivo -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Si necesitas alguna funcionalidad JavaScript adicional para el combo
    const etapaN1Select = document.querySelector('select[name="id_etapaN1"]');
    
    etapaN1Select.addEventListener('change', function() {
        const selectedEtapaN1 = this.value;
        console.log('Etapa N1 seleccionada:', selectedEtapaN1);
    });
  });
</script>
  
<script>
  // Initialize the date picker
  flatpickr("#fecha", {
    dateFormat: "d/m/Y",
  });
</script>
{% endblock %}

