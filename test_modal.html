<!DOCTYPE html>
<html>
<head>
    <title>Test Modal Trabajador</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h2>Test Modal Trabajador</h2>
        <button class="btn btn-primary" onclick="abrirModalDetalle(1)">Probar Modal Trabajador ID 1</button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Función para crear modal de detalle dinámicamente para trabajadores
        function abrirModalDetalle(id) {
            // Hacer una petición AJAX para obtener los datos completos del trabajador
            fetch(`/api/trabajador/${id}`, {
                method: 'GET',
                credentials: 'same-origin', // Incluir cookies de sesión
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                }
            })
                .then(response => {
                    console.log('Response status:', response.status);
                    if (!response.ok) {
                        throw new Error('Error al obtener datos del trabajador');
                    }
                    return response.json();
                })
                .then(trabajador => {
                    console.log('Trabajador data:', trabajador);
                    mostrarModalDetalle(trabajador);
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error al cargar datos: ' + error.message);
                });
        }

        function mostrarModalDetalle(trabajador) {
            // Eliminar modal existente si existe
            const existingModal = document.getElementById(`dynamicDetailModal${trabajador.id}`);
            if (existingModal) {
                existingModal.remove();
            }
            
            // Crear el modal HTML
            const modalHTML = `
                <div class="modal fade" id="dynamicDetailModal${trabajador.id}" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">
                                    <i class="fas fa-user"></i> Detalle del Trabajador: ${trabajador.nombre}
                                </h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <h6><i class="fas fa-id-card"></i> Información Personal</h6>
                                        <dl class="row">
                                            <dt class="col-sm-4">ID:</dt>
                                            <dd class="col-sm-8">${trabajador.id}</dd>
                                            <dt class="col-sm-4">Nombre:</dt>
                                            <dd class="col-sm-8">${trabajador.nombre}</dd>
                                            <dt class="col-sm-4">RUT:</dt>
                                            <dd class="col-sm-8"><code>${trabajador.rut || 'No disponible'}</code></dd>
                                            <dt class="col-sm-4">Profesión:</dt>
                                            <dd class="col-sm-8">${trabajador.profesion || 'Sin especificar'}</dd>
                                            <dt class="col-sm-4">Nombre Corto:</dt>
                                            <dd class="col-sm-8"><span class="badge bg-secondary">${trabajador.nombrecorto || 'N/A'}</span></dd>
                                        </dl>
                                    </div>
                                    <div class="col-md-6">
                                        <h6><i class="fas fa-building"></i> Ubicación</h6>
                                        <dl class="row">
                                            <dt class="col-sm-4">Sector:</dt>
                                            <dd class="col-sm-8">
                                                ${trabajador.sector ? `<span class="badge bg-primary">${trabajador.sector}</span>` : '<span class="badge bg-secondary">No asignado</span>'}
                                            </dd>
                                            <dt class="col-sm-4">Tipo Recinto:</dt>
                                            <dd class="col-sm-8">
                                                ${trabajador.tiporecinto ? `<span class="badge bg-warning">${trabajador.tiporecinto}</span>` : '<span class="badge bg-secondary">No disponible</span>'}
                                            </dd>
                                            <dt class="col-sm-4">Recinto:</dt>
                                            <dd class="col-sm-8">
                                                ${trabajador.recinto ? `<span class="badge bg-info">${trabajador.recinto}</span>` : '<span class="badge bg-light text-dark">Sin recinto</span>'}
                                            </dd>
                                        </dl>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Añadir modal al DOM
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            
            // Mostrar el modal
            const modal = new bootstrap.Modal(document.getElementById(`dynamicDetailModal${trabajador.id}`));
            modal.show();
            
            // Limpiar modal al cerrarlo
            modal._element.addEventListener('hidden.bs.modal', function () {
                modal._element.remove();
            });
        }
    </script>
</body>
</html>